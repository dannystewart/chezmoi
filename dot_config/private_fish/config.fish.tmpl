if status is-interactive
    # Clear and rebuild PATH
    set -e fish_user_paths # Clear user paths
    set -g fish_user_paths # Reset to empty

    # Add paths in reverse order (fish prepends)
    set path_candidates \
        /opt/homebrew/opt/openjdk/bin \
        /opt/homebrew/opt/findutils/libexec/gnubin \
        /usr/local/opt/findutils/libexec/gnubin \
        /var/lib/snapd/snap/bin \
        ~/.cargo/bin \
        ~/.rbenv/bin \
        ~/.pyenv/shims \
        ~/.pyenv/bin \
        ~/bin \
        ~/.bin \
        ~/.local/bin \
        ~/.local/bin/node \
        /usr/local/bin \
        /usr/libexec \
        /Library/Apple/usr/bin \
        /System/Cryptexes/App/usr/bin \
        /sbin \
        /opt/local/bin

    for path in $path_candidates
        if test -d $path
            fish_add_path $path
        end
    end

    # Set timezone
    set -x TZ "America/New_York"

    # Bind Tab to complete-and-search
    bind \t complete-and-search

    # Warp terminal integration (auto-Warpify subshells)
    printf 'P$f{"hook": "SourcedRcFileForWarp", "value": { "shell": "fish", "uname": "'$(uname)'" }}ï¿½'
end

# Homebrew setup
{{- if eq .chezmoi.os "darwin" }}
if test -f /opt/homebrew/bin/brew
    eval "$(/opt/homebrew/bin/brew shellenv)"
else if test -f /usr/local/bin/brew
    eval "$(/usr/local/bin/brew shellenv)"
end
{{- else if eq .chezmoi.os "linux" }}
if test -f /home/linuxbrew/.linuxbrew/bin/brew
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
end
{{- end }}

starship init fish | source
